C51 COMPILER V9.52.0.0   HC04                                                              04/23/2024 21:01:14 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE HC04
OBJECT MODULE PLACED IN hc04.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE hc04.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          
   2          #include "reg52.h"
   3          #include "delay.h"
   4          
   5          sbit Trig = P2^3;
   6          sbit Echo = P2^2;
   7          
   8          void Time1Init()
   9          {
  10   1          TMOD &= 0x0F; //设置定时器模式
  11   1          TMOD |= 0x10;
  12   1          TH1 = 0;
  13   1          TL1 = 0;
  14   1          //设置定时器0工作模式1，初始值设定0开始数数，不着急启动定时器
  15   1      }
  16          
  17          void startHC()
  18          {
  19   1          Trig = 0;
  20   1          Trig = 1;
  21   1          Delay10us();
  22   1          Trig = 0;
  23   1      }
  24          
  25          double get_distance(){
  26   1        double dis;
  27   1        double time;
  28   1        //定时器数据清零，以便下一次测距
  29   1          TH1 = 0;
  30   1          TL1 = 0;
  31   1        //1. Trig ，给Trig端口至少10us的高电平
  32   1          startHC();
  33   1          //2. echo由低电平跳转到高电平，表示开始发送波
  34   1          while(Echo == 0);
  35   1          //波发出去的那一下，开始启动定时器
  36   1          TR1 = 1;
  37   1          //3. 由高电平跳转回低电平，表示波回来了
  38   1          while(Echo == 1);
  39   1          //波回来的那一下，我们开始停止定时器
  40   1          TR1 = 0;
  41   1          //4. 计算出中间经过多少时间
  42   1          time = (TH1 * 256 + TL1)*1.085;//us为单位
  43   1          //5. 距离 = 速度 （340m/s）* 时间/2
  44   1          dis = time * 0.017;
  45   1        return dis;
  46   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     97    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.52.0.0   HC04                                                              04/23/2024 21:01:14 PAGE 2   

   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
